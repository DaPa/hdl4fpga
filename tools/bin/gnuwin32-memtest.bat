@ECHO OFF
FOR %%F IN (%0) DO SET DIRNAME=%%~DPF
DEL CMP.LOG DUMP.DAT DUMP.DAT
"%DIRNAME%"SCOPE -P %1 -D %2 -H %3 > DUMP.DAT
IF %ERRORLEVEL% NEQ 0 EXIT
ECHO "MEMORY DUMPED"
ECHO "CHECKING LFSR DATA "
"%DIRNAME%"CHECK -D %2 < DUMP.DAT
IF %ERRORLEVEL% NEQ 0 EXIT
SET I=1
:NEXT
  	"%DIRNAME%"SCOPE -P %1 -D %2 -H %3 > DUMP1.DAT
	IF %ERRORLEVEL% NEQ 0 EXIT
 	CMP DUMP.DAT DUMP1.DAT> CMP.LOG
	IF %ERRORLEVEL% EQU 0 (
		ECHO DUMP %I% OK
		SET /A I=%I%+1
		GOTO NEXT
	)
	FOR /F "DELIMS=" %%I IN ('AWK "{PRINT $7}" CMP.LOG') DO SET LINE=%%I
ECHO LINE %LINE% IS DIFFERENT
ECHO "------------" 
ECHO "- DUMP.DAT -" 
ECHO "------------" 
TAIL -N +%LINE% DUMP.DAT 2>NUL|HEAD
ECHO "-------------" 
ECHO "- DUMP1.DAT -"
ECHO "-------------" 
TAIL -N +%LINE% DUMP1.DAT 2>NUL|HEAD
