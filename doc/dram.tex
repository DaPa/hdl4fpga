\documentclass{beamer}
\usepackage[utf8]{inputenc}
\inputencoding{latin1}
\usepackage[T1]{fontenc}
\usepackage[spanish,english]{babel}
\usepackage{graphics}
\usepackage{graphicx}
\usepackage{listings}
\usepackage{ragged2e}
\usetheme[secheader=true]{Madrid}
\useinnertheme{rectangles}
\usepackage{tikz}
\beamertemplatenavigationsymbolsempty 
\title{Controlador de DDR para FPGA}
\author{Miguel A. Sagreras}
\date[2015]{}
%\institution[short name]{long name}
\begin{document}

\begin{frame}
\titlepage
{\small
Los dispositivos conocidos como FPGAs comienzan a desplazar en aplicaciones de
alta prestación a los procesadores tradicionales. En este contexto, se requiere
del uso de memoria masiva DDR DRAM. El controlador, la interfaz entre la
aplicación y la memoria, se programa en la FPGA y debe ser capaz de transferir
datos desde y hacia la memoria de manera de alcanzar las tasas límites físicas
que ofrecen los recursos de la FPGA de manera de aprovechar al máximo todo su
potencial.

}
\end{frame}

\begin{frame}
\tableofcontents
\end{frame}

\section{Lógica binaria}
\begin{frame}[t]
\frametitle{Números}
{\scriptsize \begin{center}
	\begin{tabular}[t]{r|r|r}
			Decimal           & Hexadecimal          & \visible<5-> {Binario} \\
		\hline
			               0  &                  0   & \visible<5-> {0} \\
                           1  &                  1   & \visible<5-> {\textcolor{red}{1}} \\
                           2  &                  2   & \visible<6-> {\textcolor{blue}{10}} \\
			               3  &                  3   & \visible<7-> {11} \\
			               4  &                  4   & \visible<8-> {100} \\
			               5  &                  5   & \visible<9-> {101} \\
			               6  &                  6   & \visible<10-> {110} \\
			               7  &                  7   & \visible<10-> {111} \\
			               8  &                  8   & \visible<10-> {1000} \\
           \textcolor{red}{9} &                  9  & \visible<10-> {1001} \\
	\visible<2-> {\textcolor{blue}{10}} &    \visible<2-> {A}  & \visible<10-> {1010} \\
			\visible<3-> {11} &    \visible<3-> {B}  & \visible<10-> {1011} \\
			\visible<3-> {12} &    \visible<3-> {C}  & \visible<10-> {1100} \\
			\visible<3-> {13} &    \visible<3-> {D}  & \visible<10-> {1101} \\
			\visible<3-> {14} &    \visible<3-> {E}  & \visible<10-> {1110} \\
			\visible<3-> {15} &    \visible<3-> {\textcolor{red}{F}}  & \visible<10-> {1111} \\
			\visible<4-> {16} &    \visible<4-> {\textcolor{blue}{10}} & \visible<10-> {10000} \\
	\end{tabular}\end{center}}
\end{frame}

\begin{frame}
\frametitle{Valores lógicos}
\begin{center}
	\includegraphics[width=0.9\textwidth]{logic_values.eps}
\end{center}
\end{frame}

\begin{frame}
\frametitle{Compuertas}
\begin{center}
	\includegraphics[width=\textwidth]{logic_gates.eps}
\end{center}
\end{frame}

\begin{frame}
\frametitle{Aritmética}
\begin{center}
	\includegraphics[width=\textwidth]{adder1.eps}
\end{center}
\end{frame}

\begin{frame}
\frametitle{Sumador}
\begin{center}
	\includegraphics[height=.8\textheight]{adder2.eps}
\end{center}
\end{frame}

\begin{frame}
\frametitle{Diseño}
	\begin{block}{Dificultades}
		\begin{itemize}
			\item Tiempos de propagación
				\begin{itemize}
				\item Compuertas
				\item Cables
				\end{itemize}
			\item Número de componentes
		\end{itemize}
	\end{block}
\end{frame}

%\section{ENIAC Electronic Numerical Integrator And Computer}
%\begin{frame}
%	\tableofcontents[currentsection]
%\end{frame}
%
%\begin{frame}
%%	ENIAC was built at the University of Pennsylvania between 1943 and 1945 by
%%	two professors, John Mauchly and the 24 year old J. Presper Eckert, who got
%%	funding from the war department after promising they could build a machine
%%	that would replace all the "computers", meaning the women who were employed
%%	calculating the firing tables for the army's artillery guns. 
%
%	\begin{block}{}
%	\justify
%	ENIAC se construyó en la Universidad de Pennsylvania entre 1943 y 1945 por
%	dos profesores, John Mauchly y J. Presper Eckert de 24 años quienes
%	obtuvieron fondos del departamento de guerra después de prometer que podían
%	construir una máquina que reemplazaría a todas las "computadoras",
%	refiriendose a todas las mujeres empleadas en calcular las tablas de
%	disparo de las armas de artilleria
%	\end{block}
%	\vfill
%	An Illustrated History of Computers \\
%	John Kopplin 2002
%\end{frame}
%
%\begin{frame}
%\frametitle{Descripción}
%\begin{itemize}
%	\item 1943 Físico J. Mauchly e Ingeniero J. P. Eckert
%	\item Cálculo de tablas de disparo de artilleria
%	\item Programación por interruptores y clavijas
%	\item 17.000 tubos de vacio
%	\item Aproximadamente 4.100 bits
%	\item 150 KW
%	\item 167 $m^{2}$
%	\item 500.000 USD o 6.000.000 USD actualizados
%\end{itemize}
%\end{frame}
%
%\begin{frame}
%%	The day that Mauchly and Eckert saw the first small piece of ENIAC work,
%%	the persons they ran to bring to their lab to show off their progress were
%%	some of these female computers (one of whom remarked, "I was astounded that
%%	it took all this equipment to multiply 5 by 1000").
%	\begin{block}{}
%	\justify
%	El día que Mauchly y Eckert lograron que la primera pieza pequeña de la
%	ENIAC funcionase, fueron corriendo a traer a algunas de las computadoras
%	mujeres al laboratorio para mostrarle su progreso, una de las cuales
%	remarcó "quedé atónita al ver que llevó todo ese equipo para multiplicar 5
%	por 1000".
%	\end{block}
%	\vfill
%	An Illustrated History of Computers \\
%	John Kopplin 2002
%\end{frame}
%
%\begin{frame}
%\frametitle{ENIAC o Electronic Numerical Integrator And Computer}
%\begin{center}
%	\includegraphics[height=0.8\textheight]{Eniac.jpg}
%\end{center}
%\end{frame}
%
%\section{Ley de Moore}
%\begin{frame}
%	\tableofcontents[currentsection]
%\end{frame}
%
%\begin{frame}
%\frametitle{Ley de Moore}
%	\begin{itemize}
%		\item 1975
%		\item Gordon E. Moore Co-fundador de Intel
%		\item Duplicación de la escala de integración cada dos años.
%	\end{itemize}
%	\begin{center}
%		\includegraphics[width=7cm]{mooreslaw.eps} 
%	\end{center}
%\end{frame}
%
\section{Field Programmable Gate Arrays}
\begin{frame}
	\tableofcontents[currentsection]
\end{frame}

\begin{frame}
\frametitle{Gate Arrays o Arreglos de Compuertas}
	\begin{columns}[t]
	\column{0.6\textwidth}
		\begin{itemize}
		\item C.I. con bloques prearmandos para propósito específico
		\item Ventajas
			\begin{itemize}
			\item Fabricación de gran escala
			\item Sólo requieren las máscaras de interconexión 
			\item Reduce el costo de la aplicación específica
			\end{itemize}
		\end{itemize}
	\column{0.4\textwidth}
		\begin{center}
			\includegraphics[width=\textwidth]{S-MOS_Systems_ASIC_SLA6140.jpg} 
		\end{center}
	\end{columns}
%"S-MOS Systems ASIC SLA6140" by Antoinebercovici - Own work. Licensed under CC BY-SA 3.0 via Commons - https://commons.wikimedia.org/wiki/File:S-MOS_Systems_ASIC_SLA6140.jpg#/media/File:S-MOS_Systems_ASIC_SLA6140.jpg
\end{frame}

\begin{frame}
\frametitle{FPGAs Field Programmable Gate Arrays}
	\begin{itemize}
		\item 1985 Xilinx
		\item Gate Arrays cuya red de interconexión es programable.
		\item Son los impulsores del incremento en la escala de integración
		\item Tecnología de exportación restringida
	\end{itemize}
\end{frame}

\begin{frame}
\frametitle{Ventajas}
	\begin{block}{FPGA vs procesadores}
		\begin{itemize}
			\item Más rápidas
			\item Menor consumo a igual aplicación
			\item Se adaptan a aplicaciones específicas
		\end{itemize}
	\end{block}
	\begin{block}{FPGA vs ASIC}
		\begin{itemize}
			\item Menor costo de fabricación para bajo volumen
			\item Reprogramables para actualizaciones de la aplicación
		\end{itemize}
	\end{block}
\end{frame}

\begin{frame}
\frametitle{Aplicaciones}
	\begin{columns}
		\column{0.45\textwidth}
		\begin{itemize}
			\item Aeroespacio y Defensa
			\item Electromedicina.
			\item Prototipado de ASIC.
			\item Audio
			\item Automotor
			\item Radiodifusión
			\item Electrónica de Consumo
			\item Data Center
		\end{itemize}
		\column{0.55\textwidth}
		\begin{itemize}
			\item Video \& Procesamiento de Imagen
			\item Computación de Alta Prestación
			\item Industrial
			\item Medicina
			\item Instrumentación Científica
			\item Seguridad
			\item Comunicaciones alámbricas
			\item Comunicaciones inalabámbricas
		\end{itemize}
	\end{columns}
\end{frame}

\begin{frame}[t]
\frametitle{Diagrama en bloques}
	\begin{center}
		\includegraphics[width=0.75\textwidth]{fpga.eps}
	\end{center}
\end{frame}

\begin{frame}
\frametitle{Nu Horizons Spartan 3A DSP board}
	\begin{center}
		\includegraphics[width=11cm]{nuhorizonsS3DSP.jpg}
	\end{center}
\end{frame}

\begin{frame}
\frametitle{Descripción}
\framesubtitle{Nu Horizons Spartan 3A DSP board}
	\begin{itemize}
		\item 2008
		\item Spartan 3A DSP
			\begin{itemize}
				\item 37440 LE equivalente a 14 procesadores de 32 Bits.
				\item 84 BRAM de 18Kbits
				\item 84 Unidades de DSP
				\item 250 Mhz
				\item Tecnología de exportación restringida
			\end{itemize}
		\item 32 MBytes de Memoria DDR1 333 MT/s
		\item 2 ADC
			\begin{itemize}
				\item Diferencial
				\item 14 bits
				\item 120 MS/s
				\item 500 Mhz
			\end{itemize}
		\item Video DAC salida diferencial
		\item Ethernet
		\item Precio USD 200
	\end{itemize}
\end{frame}

\begin{frame}[t]
\frametitle{Algoritmo en Lenguaje C y en Assembler Optimizado}
\framesubtitle{Ejemplo de aplicación : Convolución}
	\begin{center}
		$y[n] = \sum\limits_{i=0}^{N=84-1}\ h[i]*x[n-i]$
	\end{center}
	\begin{columns}[t]
		\column{0.4\textwidth}
		\lstinputlisting[language=C,
			tabsize=4,
			basicstyle=\ttfamily\tiny,
			keywordstyle=\color{blue}\ttfamily,
			stringstyle=\color{red}\ttfamily,
			commentstyle=\color{brown}\ttfamily]{convolution.c}
		\column{0.6\textwidth}
		\lstinputlisting[language=C,
			tabsize=4,
			basicstyle=\ttfamily\tiny,
			keywordstyle=\color{blue}\ttfamily,
			stringstyle=\color{red}\ttfamily,
			commentstyle=\color{brown}\ttfamily]{convolution.s}
	\end{columns}
\end{frame}

\begin{frame}
\frametitle{Diagrama en bloque para FPGA}
\framesubtitle{Ejemplo de aplicación : Convolución}
	\begin{center}
		$y[n] = \sum\limits_{i=0}^{N=84-1}\ h[i]*x[n-i]$
	\end{center}
	\begin{center}
		\includegraphics[width=11cm]{convolutionfpga.eps}
	\end{center}
\end{frame}

\begin{frame}[t]
\frametitle{Comparación estimativa entre FPGA y Procesador}
\framesubtitle{Ejemplo de aplicación : Convolución}
	\begin{columns}[t]
	\column{0.35\textwidth}
	\begin{block}{\small Spartan 3A DSP}
		{\scriptsize \begin{itemize}
			\item Tecnología 2004
			\item 90 nm
			\item 250 Mhz o ciclo de 4 ns
			\item Un resultado por ciclo
			\item Un resultado cada 4 ns
		\end{itemize}}
	\end{block}
	\column{0.6\textwidth}
	\begin{block}{\small Intel Corei7 920}
		{\scriptsize \begin{itemize}
			\item Tecnología 2008
			\item 45 nm
			\item 2.66 Ghz  o ciclo de 0.375 ps
			\item Un resultado cada 84 ciclos del lazo
			\item Un lazo 7 instrucciones
			\item 0.44\footnote{\tiny Computer Achitecture A Quantitative Approach 5th edition \\ Hennessy Patterson figura 3.43} ciclos por instrucción.
			\item Un resultado cada 84*7*0.44*0.375 = 97 ns
		\end{itemize}}
	\end{block}
	\end{columns}
	\begin{block}{\small Aumento de velocidad}
	\begin{center}
		$\frac{Spartan3A\ DSP}{Intel Corei7} = \frac{97 ns}{4 ns} = 24$
	\end{center}
	\end{block}
\end{frame}

\begin{frame}
\frametitle{Memoria externa}
	\begin{itemize}
		\item La FPGA tiene memoria interna pero no es masiva
		\item Se requiere de un controlador de memoria DRAM
		\item El controlador debe sostener la velocidad de transferencia de datos entre la aplicación y la memoria DRAM
	\end{itemize}
\end{frame}

\section{DDR DRAM}
\begin{frame}
	\tableofcontents[currentsection]
\end{frame}

%\begin{frame}[t]
%\frametitle{DRAM Memoria dinámica}
%	\begin{itemize}
%		\item 1966
%		\item Robert Dennard
%		\item Un transistor por bit
%	\end{itemize}
%	\begin{center}
%		\includegraphics[width=6.5cm]{onetransistor.png} 
%	\end{center}
%\end{frame}

\begin{frame}
\frametitle{Banco de Memoria de un solo transistor}
	\begin{center}
	\includegraphics[height=.8\textheight]{membank.eps}
	\end{center}
\end{frame}

%\begin{frame}
%\frametitle{Multiplexado de la dirección}
%	\begin{itemize}
%		\item 1966-
%		\item Robert Proebsting cofundador de Mostek
%		\item Divide la direccion en dos y multiplexa las partes
%			\begin{itemize}
%				\item Filas \textbf{Row}
%				\item Columnas \textbf{Column}
%			\end{itemize}
%		\item Reduce el tamaño del Chip y por consiguiente su costo.
%	\end{itemize}
%	\begin{center}
%		\includegraphics[width=0.55\textwidth]{MT4C1024-HD.jpg} \\
%		\tiny{Micron MT4C1024 Chip. 1 Mbit DRAM. Die size 8662x3969$\mu m$ 1989 - 1991}
%	\end{center}
%\end{frame}

\begin{frame}
\frametitle{Diagrama en Bloques}
\framesubtitle{MOSTEK DRAM}
	\includegraphics[width=0.9\textwidth]{dramchip.eps}
\end{frame}

%\begin{frame}[t]
%\frametitle{Versiones más reconocidas}
%\framesubtitle{DRAM}
%	\begin{block}{DRAM Asincrónica}
%		\begin{itemize}
%			\item FPM Fast Page Mode
%			\item EDO Extended Data Out - 1995
%		\end{itemize}
%	\end{block}
%	\begin{block}{SDRAM DRAM Sincrónica}
%		\begin{itemize}
%		\item SDR Single Data Rate - 1993 
%		\item DDR Double Data Rate - 2000
%			\begin{itemize}
%			\item DDR1 - 2000
%			\item DDR2 - 2003
%			\item DDR3 - 2007
%			\item DDR4 - 2014
%			\end{itemize}
%		\end{itemize}
%	\end{block}
%\end{frame}
%
%\begin{frame}
%\frametitle{Secuencia de acceso}
%\framesubtitle{DRAM}
%	\begin{itemize}
%		\item Acceder a la fila con las lineas precargardas
%		\item Conectar el amplificador de sensado y obtener el valor almacenado
%		\item Acceder a la columna
%		\item Recuperar el valor leido
%		\item Percargar las lineas a la mitad de la tension entre el 0 y el 1 lógico
%	\end{itemize}
%\end{frame}

%\begin{frame}
%\frametitle{Diagrama de tiempos FPM  y EDO}
%	\begin{center}
%		\includegraphics[width=\textwidth]{dram-timings.eps}
%	\end{center}
%\end{frame}
%
%\begin{frame}
%\frametitle{Diagrama de tiempos SDR DRAM}
%	\begin{center}
%		\includegraphics[width=\textwidth]{sdrdram-timings.eps}
%	\end{center}
%\end{frame}
%

\begin{frame}
\frametitle{Diagrama en bloque detallado de un chip de DDR3 DRAM}
	\begin{center}
		\includegraphics[width=\textwidth]{ddr3-blockdiagraman.eps}
	\end{center}
\end{frame}

\begin{frame}[t]
\frametitle{Diagrama de estados}
\framesubtitle{Especificación DDR3}
	\begin{center}
		\includegraphics[height=.75\textheight]{ddr3-statedbusy.eps}
	\end{center}
\end{frame}

\begin{frame}
\frametitle{Diagrama de tiempos}
\framesubtitle{Especificación DDR3}
\centering
	\includegraphics[width=.8\textwidth]{ddr3nrdbrst.eps} 
\end{frame}

\section{Controlador DDR DRAM}
\begin{frame}
	\tableofcontents[currentsection]
\end{frame}

\begin{frame}
\frametitle{\footnotesize Arquitectura del controlador de DDR DRAM obtenido para FPGA}
	\begin{center}
		\includegraphics[width=.95\textwidth]{ddrcntroler.eps}
	\end{center}
\end{frame}

\begin{frame}[t]
\frametitle{Constraste con fabricantes}
\scriptsize
\begin{center}
\begin{tabular}[t]{|r|c|c|c|}
	\hline
	\textcolor{blue}{Familia} & \textcolor{blue}{Spartan 3A DPS} & \textcolor{blue}{Virtex 5} & \textcolor{blue}{LatticeECP3} \\
	\hline
	\textcolor{blue}{Chip}                  & xc3sd1800a-4cs484 & xc5vlx110t-1ff1136 & LFE3-35EA-7FN484C \\
	\textcolor{blue}{Fabricante}            & Xilinx & Xilinx & Lattice \\
	\textcolor{blue}{Escala de integración} & 90 nm  & 65 nm  & 65 nm \\
	\textcolor{blue}{Grado}                 & 4      &   1    & 8 \\
	\textcolor{blue}{Tipo de DRAM}          & DDR1   & DDR2   & DDR3 \\
	\hline
	\textcolor{red}{Módulo del fabricante} \\
	\hline
	\textcolor{blue}{Velocidad   MT/s}          & 266 & 533 & 800 \\
	\textcolor{blue}{Código portable}       & no  & no  & cerrado \\
	\hline
	\textcolor{red}{Módulo obtenido}  \\
	\hline
	\textcolor{blue}{Velocidad MT/s}    & 333 & 650 & 1000 \\
	\textcolor{blue}{Código portable}       & sí   & sí & sí \\
	\hline
	\textcolor{magenta}{Aumento de velocidad}  & 25\% & 22\% & 25\% \\
	\hline

	\end{tabular}
\end{center}
\end{frame}

\begin{frame}
\frametitle{Síntesis}
\framesubtitle{Lattice ECP3 Versa Kit}
	\begin{center}
		\includegraphics[width=0.5\textwidth]{ddr3ctrl.png}
	\end{center}
\end{frame}

\begin{frame}
\frametitle{Conclusiones}
\begin{itemize}
	\item Portable.
	\item Descripción a nivel de compuerta en VHDL.
	\item Más de un 20\% de aumento de velocidad de transferencia respecto del modulo de los respectivos fabricantes.
\end{itemize}
\end{frame}
%Design Summary
%   Number of registers:    797 out of 26718 (3%)
%      PFU registers:          793 out of 24948 (3%)
%      PIO registers:            4 out of  1770 (0%)
%   Number of SLICEs:       700 out of 16632 (4%)
%      SLICEs as Logic/ROM:    568 out of 16632 (3%)
%      SLICEs as RAM:          132 out of  3204 (4%)
%      SLICEs as Carry:         45 out of 16632 (0%)
%   Number of LUT4s:        1096 out of 33264 (3%)
%      Number of logic LUTs:      742
%      Number of distributed RAM: 132 (264 LUT4s)
%      Number of ripple logic:     45 (90 LUT4s)
%      Number of shift registers:   0
%   Number of PIO sites used: 100 out of 295 (34%)
%      Number of PIO sites used for single ended IOs: 92
%      Number of PIO sites used for differential IOs: 8 (represented by 4 PIO
%     comps in NCD)
%   Number of IDDR/ODDR/TDDR cells used: 77 out of 1770 (4%)
%      Number of IDDR cells:  16
%      Number of ODDR cells:  43
%      Number of TDDR cells:  18
%   Number of PIO using at least one IDDR/ODDR/TDDR: 43 (3 differential)
%      Number of PIO using IDDR only:        0 (0 differential)
%      Number of PIO using ODDR only:       25 (1 differential)
%      Number of PIO using TDDR only:        0 (0 differential)
%      Number of PIO using IDDR/ODDR:        0 (0 differential)
%      Number of PIO using IDDR/TDDR:        0 (0 differential)
%      Number of PIO using ODDR/TDDR:        2 (2 differential)
%      Number of PIO using IDDR/ODDR/TDDR:  16 (0 differential)
%   Number of PIO FIXEDDELAY:    0
%   Number of PCS (SerDes):  0 out of 1 (0%) with bonded PIO sites
%   Number of DQSDLLs:  1 out of 2 (50%)
%   Number of PLLs:  1 out of 4 (25%)
%   Number of DLLs:  0 out of 2 (0%)
%   Number of block RAMs:  2 out of 72 (3%)
%   Number of CLKDIVs:  0 out of 2 (0%)
%   Number of GSRs:  1 out of 1 (100%)
%   JTAG used :      No
%   Readback used :  No
%   Oscillator used :  No
%   Startup used :   No
%   Notes:-
%
%      1. Total number of LUT4s = (Number of logic LUT4s) + 2*(Number of
%     distributed RAMs) + 2*(Number of ripple logic)
%      2. Number of logic LUT4s does not include count of distributed RAM and
%     ripple logic.
%
\end{document}

